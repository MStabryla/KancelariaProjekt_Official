<div class="loading" *ngIf="isLoadingResults">
  <mat-spinner></mat-spinner>
</div>
<mat-toolbar>
  <mat-toolbar-row style="justify-content: space-around;background-color:lightgray">
    <button class="toolbarButton" mat-icon-button (click)="openAdd()">
      {{'ADD' | translate}}<mat-icon>post_add</mat-icon>
    </button>
    <button class="toolbarButton" [matMenuTriggerFor]="editMenu" mat-icon-button [disabled]="selection.isEmpty()">
      {{'MODIFY' | translate}}<mat-icon>create</mat-icon>
    </button>
    <mat-menu #editMenu>
      <button mat-menu-item (click)="openEdit(0)">
        <mat-icon>edit_note</mat-icon>
        <span>{{'EDIT' | translate}}</span>
      </button>
      <button mat-menu-item (click)="openEdit(1)" *ngIf="(_authService.currentSelectedCompany | async).isInBoard">
        <mat-icon>content_copy</mat-icon>
        <span>{{'CORRECTION' | translate}}</span>
      </button>
      <button mat-menu-item (click)="openEdit(2)" *ngIf="(_authService.currentSelectedCompany | async).isInBoard">
        <mat-icon>copy_all</mat-icon>
        <span>{{'COPY' | translate}}</span>
      </button>
      <button mat-menu-item (click)="delate()" *ngIf="(_authService.currentSelectedCompany | async).isInBoard">
        <mat-icon>remove_circle</mat-icon>
        <span>{{'DELETE' | translate}}</span>
      </button>
    </mat-menu>
    <button class="toolbarButton" mat-icon-button (click)="openSerch()" [disabled]="selection.isEmpty()">
      {{'INVOICES.INVOICE_TABLE.LOOKUP_CLICK' | translate}}<mat-icon>search</mat-icon>
    </button>
    <button class="toolbarButton" mat-icon-button (click)="oetJPK()" [disabled]="selection.isEmpty()">
      {{'INVOICES.INVOICE_TABLE.JPK_CLICK' | translate}}<mat-icon>receipt_long</mat-icon>
    </button>
    <button class="toolbarButton" [matMenuTriggerFor]="sendMenu" mat-icon-button>
      {{'INVOICES.INVOICE_TABLE.SENDING_HISTORY_CLICK' | translate}} <mat-icon>email</mat-icon>
    </button>
    <mat-menu #sendMenu>
      <button mat-menu-item (click)="openSendByMail()" [disabled]="selection.isEmpty()">
        <mat-icon>mark_email_unread</mat-icon>
        <span> {{'INVOICES.INVOICE_TABLE.INVOICE_SENDING_SELECTED_HISTORY_CLICK' | translate}}</span>
      </button>
      <button mat-menu-item (click)="EditMailTempaltes()">
        <mat-icon>mark_email_unread</mat-icon>
        <span> {{'INVOICES.INVOICE_TABLE.INVOICE_SENDING_TEMPLATES_EDIT_CLICK' | translate}}</span>
      </button>
      <a mat-menu-item routerLink="/sendedinvoices">
        <mat-icon>forward_to_inbox</mat-icon>
        <span> {{'INVOICES.INVOICE_TABLE.INVOICE_SENDING_HISTORY_CLICK' | translate}}</span>
      </a>
    </mat-menu>

  </mat-toolbar-row>
</mat-toolbar>
<mat-table [dataSource]="dataSource" matSort matSortActive="Number" matSortDisableClear matSortDirection="asc">

  <!-- Checkbox Column -->
  <ng-container matColumnDef="select">
    <th scope="col" mat-header-cell *matHeaderCellDef>
      <mat-checkbox (change)="$event ? masterToggle() : null"
                    [checked]="selection.hasValue() && isAllSelected()"
                    [indeterminate]="selection.hasValue() && !isAllSelected()">
      </mat-checkbox>
    </th>
    <td mat-cell *matCellDef="let row">
      <mat-checkbox (click)="$event.stopPropagation()"
                    (change)="$event ? selection.toggle(row) : null"
                    [checked]="selection.isSelected(row)">
      </mat-checkbox>
    </td>
  </ng-container>

  <ng-container matColumnDef="Number">
    <mat-header-cell *matHeaderCellDef mat-sort-header>
      <mat-form-field class="inputfillter" appearance="outline" [formGroup]="filter" (click)="$event.stopPropagation()">
        <mat-label>{{'NUMBER' | translate}}</mat-label>
        <input matInput placeholder="Wyszukaj" formControlName="Number">
      </mat-form-field>
    </mat-header-cell>
    <mat-cell *matCellDef="let element"> {{element.number}} </mat-cell>
  </ng-container>

  <ng-container matColumnDef="Correcting">
    <mat-header-cell *matHeaderCellDef mat-sort-header>
      <mat-form-field class="inputfillter" appearance="outline" [formGroup]="filter" (click)="$event.stopPropagation()">
        <mat-label>{{'CORRECTION' | translate}}</mat-label>
        <input matInput placeholder="Wyszukaj" formControlName="Correcting">
      </mat-form-field>
    </mat-header-cell>
    <mat-cell *matCellDef="let element">
      <div *ngIf="element.correcting !='';else notCorrecting">
        {{element.correcting}}
      </div>
      <ng-template #notCorrecting>
        <mat-icon>close</mat-icon>
      </ng-template>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="PaymentCurrency">
    <mat-header-cell *matHeaderCellDef mat-sort-header>
      <mat-form-field class="inputfillter" appearance="outline" [formGroup]="filter" (click)="$event.stopPropagation()">
        <mat-label>{{'CURRENCY' | translate}}</mat-label>
        <input matInput placeholder="Wyszukaj" formControlName="PaymentCurrency">
      </mat-form-field>
    </mat-header-cell>
    <mat-cell *matCellDef="let element"> {{element.paymentCurrency}} </mat-cell>
  </ng-container>


  <ng-container matColumnDef="NettoWorth" style="width:100%">
    <mat-header-cell *matHeaderCellDef mat-sort-header style="width:100%" class="rangeFilter">
      <div class="inputfillter" style="width:100%">
        <mat-form-field appearance="outline" [formGroup]="numericFilter" (click)="$event.stopPropagation()">
          <mat-label>{{'NETTO_VALUE' | translate}}</mat-label>
          <input matInput placeholder="Od" type="number" formControlName="NettoWorthFrom">
        </mat-form-field>
        <mat-form-field appearance="outline" [formGroup]="numericFilter" (click)="$event.stopPropagation()">
          <mat-label></mat-label>
          <input matInput placeholder="Do" type="number" formControlName="NettoWorthTo">
        </mat-form-field>
      </div>
    </mat-header-cell>
    <mat-cell *matCellDef="let element"> {{element.nettoWorth}} </mat-cell>
  </ng-container>

  <ng-container matColumnDef="BruttoWorth" style="width:100%">
    <mat-header-cell *matHeaderCellDef mat-sort-header style="width:100%" class="rangeFilter">
      <div class="inputfillter" style="width:100%">
        <mat-form-field appearance="outline" [formGroup]="numericFilter" (click)="$event.stopPropagation()">
          <mat-label>{{'BRUTTO_VALUE' | translate}}</mat-label>
          <input matInput placeholder="Od" type="number" formControlName="BruttoWorthFrom">
        </mat-form-field>
        <mat-form-field appearance="outline" [formGroup]="numericFilter" (click)="$event.stopPropagation()">
          <mat-label></mat-label>
          <input matInput placeholder="Do" type="number" formControlName="BruttoWorthTo">
        </mat-form-field>
      </div>
    </mat-header-cell>
    <mat-cell *matCellDef="let element"> {{element.bruttoWorth}} </mat-cell>
  </ng-container>

  <ng-container matColumnDef="PaymentStatus">
    <mat-header-cell *matHeaderCellDef mat-sort-header>
      <mat-form-field class="selectdisplayfix" appearance="outline" [formGroup]="filter" (click)="$event.stopPropagation()">
        <mat-label>{{'INVOICES.INVOICE_TABLE.PAYMENT_STATUS_LABEL' | translate}}</mat-label>
        <mat-select formControlName="PaymentStatus">
          <mat-option>None</mat-option>
          <mat-option value="0">{{'INVOICES.INVOICE_TABLE.UNPAID_LABEL' | translate}}</mat-option>
          <mat-option value="1">{{'INVOICES.INVOICE_TABLE.PAID_LABEL' | translate}}</mat-option>
          <mat-option value="2">{{'INVOICES.INVOICE_TABLE.OWERPAID_LABEL' | translate}}</mat-option>
        </mat-select>
      </mat-form-field>
    </mat-header-cell>
    <mat-cell *matCellDef="let element">
      <div *ngIf="element.paymentStatus ==0">
        <mat-icon>close</mat-icon>
      </div>
      <div *ngIf="element.paymentStatus ==1">
        <mat-icon>done</mat-icon>
      </div>
      <div *ngIf="element.paymentStatus ==2">
        <mat-icon>done_all</mat-icon>
      </div>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="Created">
    <mat-header-cell *matHeaderCellDef mat-sort-header>
      <mat-form-field [formGroup]="dateFilter" appearance="outline" (click)="$event.stopPropagation()">
        <mat-label>{{'CREATION_DATE' | translate}}</mat-label>
        <mat-date-range-input [rangePicker]="createdFilterPicker">
          <input matStartDate placeholder="{{'FROM' | translate | lowercase}}" formControlName="CreatedStart">
          <input matEndDate placeholder="{{'TO' | translate | lowercase}}" formControlName="CreatedEnd">
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="createdFilterPicker"></mat-datepicker-toggle>
        <mat-date-range-picker #createdFilterPicker></mat-date-range-picker>
      </mat-form-field>
    </mat-header-cell>
    <mat-cell *matCellDef="let element"> {{toISOSDateString(element.created)}} </mat-cell>
  </ng-container>

  <mat-header-row *matHeaderRowDef="displayedInvoiceColumns"></mat-header-row>

  <mat-row *matRowDef="let row; columns: displayedInvoiceColumns;" (click)="selection.toggle(row)" (dblclick)="openEdit(0,row)"></mat-row>
</mat-table>

<mat-paginator [length]="invoicesTotalCount" [pageSize]="5" [pageSizeOptions]="[5,10,20,50]" [showFirstLastButtons]="true"></mat-paginator>


<table aria-label="Calculator Table" mat-table [dataSource]="calculator">
  <ng-container matColumnDef="paymentCurrency">
    <th scope="col" mat-header-cell *matHeaderCellDef> {{'CURRENCY' | translate}} </th>
    <td mat-cell *matCellDef="let element"> {{element.paymentCurrency}} </td>
  </ng-container>

  <ng-container matColumnDef="nettoWorth">
    <th scope="col" mat-header-cell *matHeaderCellDef> {{'NETTO_VALUE' | translate}} </th>
    <td mat-cell *matCellDef="let element"> {{element.nettoWorth}} </td>
  </ng-container>

  <ng-container matColumnDef="bruttoWorth">
    <th scope="col" mat-header-cell *matHeaderCellDef> {{'BRUTTO_VALUE' | translate}} </th>
    <td mat-cell *matCellDef="let element"> {{element.bruttoWorth}} </td>
  </ng-container>

  <ng-container matColumnDef="vat">
    <th scope="col" mat-header-cell *matHeaderCellDef> {{'VAT_VALUE' | translate}} </th>
    <td mat-cell *matCellDef="let element"> {{element.vat}} </td>
  </ng-container>

  <ng-container matColumnDef="paymentValue">
    <th scope="col" mat-header-cell *matHeaderCellDef>{{'INVOICES.INVOICE_TABLE.PAYMENTS_VALUES_LABEL' | translate}} </th>
    <td mat-cell *matCellDef="let element"> {{element.paymentValue}} </td>
  </ng-container>

  <ng-container matColumnDef="paymentStatus">
    <th scope="col" mat-header-cell *matHeaderCellDef>{{'INVOICES.INVOICE_TABLE.TO_PAY_LABEL' | translate}} </th>
    <td mat-cell *matCellDef="let element">{{element.paymentStatus}} </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedCalculatorColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedCalculatorColumns;"></tr>
</table>
